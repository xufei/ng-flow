<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Angular Workflow</title>

    <script type="text/javascript" src="libs/angular.min.js"></script>

    <script type="text/javascript" src="js/app.js"></script>

    <script type="text/javascript" src="js/model/workflowfactory.js"></script>
    <script type="text/javascript" src="js/model/activity.js"></script>
    <script type="text/javascript" src="js/model/sequential.js"></script>
    <script type="text/javascript" src="js/model/statemachine.js"></script>
    <script type="text/javascript" src="js/model/activityfactory.js"></script>
    <script type="text/javascript" src="js/model/start.js"></script>
    <script type="text/javascript" src="js/model/finish.js"></script>
    <script type="text/javascript" src="js/model/if.js"></script>
    <script type="text/javascript" src="js/model/switch.js"></script>
    <script type="text/javascript" src="js/model/while.js"></script>
    <script type="text/javascript" src="js/model/for.js"></script>
    <script type="text/javascript" src="js/model/statement.js"></script>
    <script type="text/javascript" src="js/model/transition.js"></script>
    <script type="text/javascript" src="js/model/condition.js"></script>

    <script type="text/javascript" src="js/controller/flow.js"></script>

</head>
<body ng-app="workflow">
<div ng-controller="FlowCtrl as flowCtrl">
    <ul>
        <li ng-repeat="flow in flowCtrl.flows">
            <button ng-click="flowCtrl.showInsertPosition(flow)">edit</button></li>
        <li>
            <button ng-click="flowCtrl.addFlow()">+</button>
        </li>
    </ul>
    <div ng-repeat="flow in flowCtrl.flows">
        <svg width="800" height="800" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <g id="insertPoint">
                    <circle r="5" stroke="#17301D" fill="#ffffff" stroke-width="1"/>
                </g>

                <g id="start">
                    <circle cx="20" cy="20" r="20" fill="#219E3E" stroke="#17301D" stroke-width="2"/>
                </g>

                <g id="decision">
                    <polygon points="0,25 50,0 100,25 50,50" fill="#219E3E" stroke="#17301D" stroke-width="2"/>
                </g>

                <g id="finish">
                    <rect width="40" height="40" fill="#219E3E" stroke="#17301D" stroke-width="2"/>
                </g>

                <g id="statement">
                    <rect width="80" height="40" fill="#219E3E" stroke="#17301D" stroke-width="2"/>
                </g>

                <marker id="markerCircle" markerWidth="8" markerHeight="8" refx="5" refy="5">
                    <circle cx="5" cy="5" r="3" style="stroke: none; fill:#000000;"/>
                </marker>

                <marker id="insertPoint" markerWidth="8" markerHeight="8" refx="5" refy="5">
                    <circle cx="5" cy="5" r="3" style="stroke: none; fill:#000000;"/>
                </marker>

                <marker id="markerArrow" markerWidth="13" markerHeight="13" refx="2" refy="6" orient="auto">
                    <path d="M2,2 L2,11 L10,6 L2,2" style="fill: #000000;"/>
                </marker>
            </defs>

            <use ng-repeat="activity in flow.activities"
                 ng-attr-x="{{flowCtrl.nodeX(activity)}}"
                 ng-attr-y="{{flowCtrl.nodeY(activity)}}"
                 xlink:href="{{'#' + activity.type}}"/>

            <path ng-repeat="transition in flow.transitions"
                  ng-attr-d="{{flowCtrl.path(transition)}}"
                  style="stroke: #6666ff; stroke-width: 1px; fill: none;
                   marker-start: url(#markerCircle);
                   marker-mid:url(#arrow);
                   marker-end: url(#markerArrow)"/>

            <use ng-repeat="transition in flow.transitions" ng-show="flow.isEditing"
                 ng-attr-x="{{flowCtrl.insertPositionX(transition)}}"
                 ng-attr-Y="{{flowCtrl.insertPositionY(transition)}}"
                 xlink:href="#insertPoint" ng-click="flowCtrl.insertActivity(flow, transition)"/>


            <!--use x="100" y="100" xlink:href="#start"/>
            <use x="100" y="200" xlink:href="#node"/>
            <use x="100" y="300" xlink:href="#decision"/>
            <use x="100" y="400" xlink:href="#node"/>
            <use x="100" y="500" xlink:href="#finish"/>

            <line x1="150" y1="130" x2="150" y2="190" stroke="#6666ff" stroke-width="1" marker-end="url(#markerArrow)"/>
            <line x1="150" y1="240" x2="150" y2="290" stroke="#6666ff" stroke-width="1" marker-end="url(#markerArrow)"/>
            <line x1="150" y1="350" x2="150" y2="390" stroke="#6666ff" stroke-width="1" marker-end="url(#markerArrow)"/>
            <line x1="150" y1="440" x2="150" y2="490" stroke="#6666ff" stroke-width="1" marker-end="url(#markerArrow)"/>

            <path d="M200,325 L250,325 L250,520 L180,520"
                  style="stroke: #6666ff; stroke-width: 1px; fill: none;
                   marker-start: url(#markerCircle);
                   marker-mid:url(#arrow);
                   marker-end: url(#markerArrow) "
                    /-->

        </svg>
    </div>
</div>


</body>
</html>